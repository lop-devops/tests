include tests-shared.cfg

username = root
password = 123456
main_vm = virt-tests-vm1
vms = virt-tests-vm1
#Network
nettype = bridge
netdst = virbr0
display = nographic
vga = none
take_regular_screendumps = no
keep_screendumps_on_error = no
keep_screendumps = no
store_vm_register = no
virt_install_binary = /usr/bin/virt-install
qemu_img_binary = /usr/bin/qemu-img
hvm_or_pv = hvm
machine_type = pseries
only bridge
no xen, lxc, esx, ovmf
#Filterout unwanted disk types
no ide,xenblk,lsi_scsi,ahci,sd
no qed,qcow2v3,raw_dd,vmdk, usb2
no e1000-82540em,e1000-82545em,e1000-82544gc,xennet,nic_custom
only no_virtio_rng
only smp2
only no_9p_export
only no_pci_assignable
only (image_backend=filesystem)
only smallpages
smp = 144
vcpu_cores = 18
vcpu_threads = 8
vcpu_sockets = 1
mem = 131072
only virtio_net
only qcow2
only virtio_scsi
# User can change the disk as per need
image_size = 50G
create_vm_libvirt=yes 
kill_vm_libvirt=yes 
kill_vm=yes 
env_cleanup=yes 
backup_image_before_testing=no 
restore_image_after_testing=no 
kernel_args='root=/dev/sda2 rw console=tty0 console=ttyS0,115200 init=/sbin/init initcall_debug selinux=0' 
qemu_binary=/usr/local/lib/python3.9/site-packages/virttest/bin/install_root/bin/qemu-system-ppc64 
emulator_path=/usr/local/lib/python3.9/site-packages/virttest/bin/install_root/bin/qemu-system-ppc64
kernel=/home/epcci/guest/linux/vmlinux
guest_script = "http://ltc-jenkins.aus.stglabs.ibm.com:81/sath/epcci/nested.sh"
virtinstall_qemu_cmdline=" -M pseries,cap-nested-hv=on"
login_timeout = 600
serial_login = no


variants:
    - L1:
        pre_command = "rm -rf /home/epcci/guest;mkdir -p /home/epcci/guest/;git clone --depth 1 https://github.com/torvalds/linux /home/epcci/guest/linux/ && cd /home/epcci/guest/linux/ && wget http://ltc-jenkins.aus.stglabs.ibm.com:81/sath/epcci/0001-Add-additional-kernel-configs.patch && git am 0001-Add-additional-kernel-configs.patch && git log -2 && make ppc64le_guest_defconfig && make -j 100 -s"
        only nested_test
