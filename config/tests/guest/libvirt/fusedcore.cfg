include tests-shared.cfg
username = root
password = 123456
test_timeout=360000
main_vm = virt-tests-vm1
vms = virt-tests-vm1
nettype = bridge
netdst = virbr0
# Using Text mode of installation
display = 'nographic'
take_regular_screendumps = no
keep_screendumps_on_error = no
keep_screendumps = no
vm_info_delay = 60
store_vm_info = yes
vm_info_cmds = "registers,pic"
virt_install_binary = /usr/bin/virt-install
qemu_img_binary = /usr/bin/qemu-img
hvm_or_pv = hvm
machine_type = pseries
only bridge
no xen, lxc, esx, ovmf
# Filterout unwanted disk types
no ide,xenblk,lsi_scsi,ahci,sd
no qed,qcow2v3,raw_dd,vmdk, usb2
no e1000-82540em,e1000-82545em,e1000-82544gc,xennet,nic_custom
only no_virtio_rng
only smp2
only no_9p_export
only no_pci_assignable
only (image_backend = filesystem)
only smallpages
vcpu_maxcpus = 16
vcpu_threads = 1
vcpu_cores = 16
smp = 16
mem = 4096
sockets = 1
vcpu_sockets = 1
setvcpus_max = 16
only virtio_net
only virtio_scsi
only qcow2
main_vm = vm1
create_vm_libvirt = yes
kill_vm_libvirt = yes
env_cleanup = yes
backup_image_before_testing = no
restore_image_after_testing = no
vms = "vm1 vm2 vm3 vm5 vm6 vm7"
# just removed xics, hash, smt8 power9, power10 guest
#vms = "vm1 vm2 vm3 vm4 vm5 vm6 vm7 vm8"
host_stress_args = "--cpu 60 --io 6 --vm 6 --vm-bytes 256M --timeout 7000s"
qemu_binary=/home/sath/qemu/build/qemu-system-ppc64
emulator_path=/home/sath/qemu/build/qemu-system-ppc64
kernel=/home/sath/linux/vmlinux
initrd=''
kernel_args='root=/dev/sda2 rw console=tty0 console=ttyS0,115200 init=/sbin/init initcall_debug selinux=0 powersave=off'
variants:
    - mixedmode_multivm:
        kernel_args_vm3='root=/dev/sda2 rw console=tty0 console=ttyS0,115200 init=/sbin/init initcall_debug selinux=0 disable_radix powersave=off'
        kernel_args_vm4='root=/dev/sda2 rw console=tty0 console=ttyS0,115200 init=/sbin/init initcall_debug selinux=0 disable_radix powersave=off'
        kernel_args_vm7='root=/dev/sda2 rw console=tty0 console=ttyS0,115200 init=/sbin/init initcall_debug selinux=0 disable_radix powersave=off'
        kernel_args_vm8='root=/dev/sda2 rw console=tty0 console=ttyS0,115200 init=/sbin/init initcall_debug selinux=0 disable_radix powersave=off'
        virtinstall_qemu_cmdline_vm1 = " -M pseries,vsmt=1,ic-mode=xics,cap-cfpc=broken,cap-sbbc=broken,cap-ibs=broken,cap-ccf-assist=off"
        virtinstall_qemu_cmdline_vm2 = " -M pseries,vsmt=2,cap-cfpc=broken,cap-sbbc=broken,cap-ibs=broken,cap-ccf-assist=off"
        virtinstall_qemu_cmdline_vm3 = " -M pseries,vsmt=4,cap-cfpc=broken,cap-sbbc=broken,cap-ibs=broken,cap-ccf-assist=off"
        virtinstall_qemu_cmdline_vm4 = " -M pseries,vsmt=8,ic-mode=xics,cap-cfpc=broken,cap-sbbc=broken,cap-ibs=broken,cap-ccf-assist=off"
        virtinstall_qemu_cmdline_vm5 = " -M pseries,vsmt=1,max-cpu-compat=power9,ic-mode=xics,cap-cfpc=broken,cap-sbbc=broken,cap-ibs=broken,cap-ccf-assist=off"
        virtinstall_qemu_cmdline_vm6 = " -M pseries,vsmt=2,max-cpu-compat=power9,cap-cfpc=broken,cap-sbbc=broken,cap-ibs=broken,cap-ccf-assist=off"
        virtinstall_qemu_cmdline_vm7 = " -M pseries,vsmt=4,max-cpu-compat=power9,cap-cfpc=broken,cap-sbbc=broken,cap-ibs=broken,cap-ccf-assist=off"
        virtinstall_qemu_cmdline_vm8 = " -M pseries,max-cpu-compat=power9,ic-mode=xics,cap-cfpc=broken,cap-sbbc=broken,cap-ibs=broken,cap-ccf-assist=off"
        stress_args = '--cpu 12 --io 15 --vm 4 --vm-bytes 512M --timeout 7200s'
        host_stress = no
        only multivm_cpustress.custom_host_events.custom_vm_events
        stress_itrs = 50
        guest_stress = yes
        cores_vm2 = 8
        threads_vm2 = 2
        vcpu_cores_vm2 = 8
        vcpu_threads_vm2 = 2
        cores_vm3 = 4
        threads_vm3 = 4
        vcpu_cores_vm3 = 4
        vcpu_threads_vm3 = 4
        cores_vm4 = 2
        threads_vm4 = 8
        vcpu_cores_vm4 = 2
        vcpu_threads_vm4 = 8
        cores_vm6 = 8
        threads_vm6 = 2
        vcpu_cores_vm6 = 8
        vcpu_threads_vm6 = 2
        cores_vm7 = 4
        threads_vm7 = 4
        vcpu_cores_vm7 = 4
        vcpu_threads_vm7 = 4
        cores_vm8 = 2
        threads_vm8 = 8
        vcpu_cores_vm8 = 2
        vcpu_threads_vm8 = 8
        variants:
            - only_vcpuhotplug:
                stress_events = "cpuhotplug"
                smp = 8
            - only_suspend:
                stress_events = "suspend"
            - guestreboot:
                mem = 2048
                stress_events = "reboot"
                guest_stress = no
                stress_itrs = 100
            - only_vcpupin:
                stress_events = "vcpupin,emulatorpin"
            - pin_suspend:
                stress_events = "vcpupin,emulatorpin,suspend"
            - pin_vcpuhotplug:
                stress_events = "vcpupin,emulatorpin,cpuhotplug"
                smp = 8


    - default_multivm:
        virtinstall_qemu_cmdline = " -M pseries,cap-cfpc=broken,cap-sbbc=broken,cap-ibs=broken,cap-ccf-assist=off"
        host_stress = no
        stress_args = '--cpu 12 --io 15 --vm 5 --vm-bytes 512M --timeout 7200s'
        only multivm_cpustress.with_hoststress.without_hoststress_events.custom_vm_events
        stress_itrs = 50
        variants:
            - only_vcpuhotplug:
                stress_events = "cpuhotplug"
                smp = 8
            - only_suspend:
                stress_events = "suspend"
            - guestreboot:
                mem = 2048
                stress_events = "reboot"
                guest_stress = no
                stress_itrs = 100
            - only_vcpupin:
                stress_events = "vcpupin,emulatorpin"
            - pin_suspend:
                stress_events = "vcpupin,emulatorpin,suspend"
            - pin_vcpuhotplug:
                stress_events = "vcpupin,emulatorpin,cpuhotplug"
                smp = 8

