include tests-shared.cfg
username = root
password = 123456
main_vm = vm1
vms = vm1
vm_type = libvirt
virt_install_binary = /usr/bin/virt-install
qemu_img_binary = /usr/bin/qemu-img
hvm_or_pv = hvm
machine_type = pseries
use_os_variant = no
use_os_type = no
only bridge
only smp2
only no_9p_export
only no_virtio_rng
only no_pci_assignable
only (image_backend=filesystem)
only smallpages
kill_vm = yes
kill_vm_libvirt = yes
env_cleanup = yes
create_vm_libvirt = yes
vga = None
display = nographic
take_regular_screendumps = no
backup_image_before_testing = no
avocado_reinstall = False
test_timeout = 3600000
only qcow2
only virtio_scsi
only virtio_net
mem = 8192
qemu_binary = /usr/share/avocado-plugins-vt/bin/install_root/bin/qemu-system-ppc64
emulator_path = /usr/share/avocado-plugins-vt/bin/install_root/bin/qemu-system-ppc64
bios_path = /usr/share/avocado-plugins-vt/bin/install_root/share/qemu/slof.bin

variants:
    - secure:
        # this guest image has modified initrd image using svm-tools
        # and addtional kernel cmdline option svm=on xive=off to enable
        # svm functionality.
        image_name = images/rhel8-devel-ppc64le-svm
        # https://bugzilla.linux.ibm.com/show_bug.cgi?id=186761
        tpm_device_path = "/dev/tpmrm0"
        tpm_model = "spapr-tpm-proxy"
        virtinstall_qemu_cmdline=" -M pseries,x-svm-allowed=on -global virtio-scsi-pci.disable-legacy=on -global virtio-scsi-pci.disable-modern=off -global virtio-scsi-pci.iommu_platform=on -global virtio-blk-pci.disable-legacy=on -global virtio-blk-pci.disable-modern=off -global virtio-blk-pci.iommu_platform=on -global virtio-net-pci.disable-legacy=on -global virtio-net-pci.disable-modern=off -global virtio-net-pci.iommu_platform=on -global virtio-serial-pci.disable-legacy=on -global virtio-serial-pci.disable-modern=off -global virtio-serial-pci.iommu_platform=on -global virtio-balloon-pci.disable-legacy=on -global virtio-balloon-pci.disable-modern=off -global virtio-balloon-pci.iommu_platform=on"
        smp = 32
        mem = 81920
        vcpu_cores = 32
        vcpu_threads = 1
        vcpu_sockets =  1
        vcpu_maxcpus = 32
        variants:
            - singlevm:
                variants:
                    - reboottest:
                        only io-github-autotest-qemu.reboot
                        reboot_count = 100
                        variants:
                            - 512M:
                                smp = 1
                                vcpu_maxcpus = 1
                                vcpu_threads = 1
                                vcpu_maxcpus = 1
                                vcpu_cores = 1
                                mem = 512
                            - 1G:
                                mem = 1024
                            - 2G:
                                mem = 2048
                            - 4G:
                                mem = 4096
                            - 8G:
                                mem = 8192
                            - 16G:
                                mem = 16384
                            - 32G:
                                vcpu_cores = 16
                                smp = 16
                                vcpu_maxcpus = 16
                                mem = 32768
                            - 64G:
                                vcpu_cores = 16
                                smp = 16
                                vcpu_maxcpus = 16
                                mem = 65536
                                login_timeout = 450
                            - 128G:
                                vcpu_cores = 32
                                smp = 32
                                vcpu_maxcpus = 32
                                mem = 131072
                                login_timeout = 660

                    - vcpuhotplug:
                        start_vm = yes
                        test_itr = 2
                        vcpu_max_timeout = 480
                        vcpu_sockets =  1
                        vcpu_maxcpus = 64
                        topology_correction = "no"
                        variants:
                            - 1thread:
                                vcpu_cores = 64
                                smp = 1
                                vcpu_threads = 1
                                vcpu_current_num = 1
                                vcpu_plug_num = 64
                                vcpu_unplug_num = 1
                                vcpu_max_num = 64
                                only libvirt_vcpu_plug_unplug..with_maxvcpu
                            - 2threads:
                                smp = 2
                                vcpu_cores = 32
                                vcpu_threads = 2
                                vcpu_current_num = 2
                                vcpu_plug_num = 64
                                vcpu_unplug_num = 2
                                vcpu_max_num = 64
                                only libvirt_vcpu_plug_unplug..with_maxvcpu
                            - 4threads:
                                smp = 4
                                vcpu_cores = 16
                                vcpu_threads = 4
                                vcpu_current_num = 4
                                vcpu_plug_num = 64
                                vcpu_unplug_num = 4
                                vcpu_max_num = 64
                                only libvirt_vcpu_plug_unplug..with_maxvcpu
                            - 8threads:
                                smp = 8
                                vcpu_cores = 8
                                vcpu_threads = 8
                                vcpu_current_num = 8
                                vcpu_plug_num = 64
                                vcpu_unplug_num = 8
                                vcpu_max_num = 64
                                only libvirt_vcpu_plug_unplug..with_maxvcpu
                    - memoryhotplug:
                        attach_times = 15
                        only libvirt_mem.positive_test.memory.hot.unplug.max_slots.with_rand_reboot
                    - guestdump:
                        only virsh.dump.positive_test.non_acl.live_dump
                    - diskhotplug:
                        at_dt_disk_device_target = sdb
                        only virsh.attach_detach_disk_matrix..at_option_live
                        no dt_option_live_config,dt_option_config,dt_option_default,dt_option_live_config,at_okay_dt_error,at_error_dt_error,pre_vm_state_shutoff,pre_vm_state_paused,pre_vm_state_transient,dt_option_current
                    - guesttests:
                        variants:
                            - memory:
                                mem = 8192
                                only avocado_guest.memhotplug,avocado_guest.eatmemory,avocado_guest.memintegrity
                            - generic:
                                test_timeout = 600000
                                only avocado_guest.ltp
                                # kself test needs a src rpm for distro
                                #only avocado_guest.ltp,avocado_guest.kselftest 
                            - cpu:
                                vcpu_cores = 4
                                vcpu_threads = 8
                                vcpu_sockets =  1
                                vcpu_maxcpus = 32
                                only avocado_guest.ebizzy,avocado_guest.ppc64_cpu_test 
                            - io:
                                vcpu_cores = 16
                                vcpu_threads = 2
                                vcpu_sockets =  1
                                vcpu_maxcpus = 32
                                only avocado_guest.fiotest
 
            - multivm:
                # this has to set based on host svm memory, in this case we have 512G svm mem on host
                #mem = 4096
                mem = 8192
                #mem = 12288
                #mem = 65536
                login_timeout = 500
                vms = "vm1 vm2 vm3 vm4"
                vms = "vm1"
                drive_format_vm2=virtio
                scsi_hba_vm2=""
                libvirt_controller_vm2=""
                smp_vm1 = 32
                vcpu_cores_vm1 = 32
                vcpu_threads_vm1 = 1
                vcpu_sockets_vm1 =  1
                vcpu_maxcpus_vm1 = 32
                smp_vm2 = 32
                vcpu_cores_vm2 = 16
                vcpu_threads_vm2 = 2
                vcpu_sockets_vm2 =  1
                vcpu_maxcpus_vm2 = 32
                smp_vm3 = 32
                vcpu_cores_vm3 = 8
                vcpu_threads_vm3 = 4
                vcpu_sockets_vm3 =  1
                vcpu_maxcpus_vm3 = 32
                smp_vm4 = 32
                vcpu_cores_vm4 = 4
                vcpu_threads_vm4 = 8
                vcpu_sockets_vm4 =  1
                vcpu_maxcpus_vm4 = 32
                reboot_count = 6
                variants:
                    - reboottest:
                        guest_stress = no
                        host_stress = no
                        host_stress_events = ""
                        stress_events = "reboot"
                        stress_itrs = 100
                        test_timeout = 1800000
                        event_sleep_time = 30
                        itr_sleep_time = 30
                        only multivm_cpustress.custom_host_events.custom_vm_events
                    - cpupin_withstress:
                        guest_stress = yes
                        host_stress = no
                        host_stress_events = ""
                        stress_events = "vcpupin,emulatorpin"
                        stress_itrs = 500
                        test_timeout = 6000000
                        event_sleep_time = 30
                        itr_sleep_time = 30
                        only multivm_cpustress.custom_host_events.custom_vm_events

    - nonsecure:
        image_name = images/rhel8-devel-ppc64le
        virtinstall_qemu_cmdline=" -M pseries,x-svm-allowed=off -global virtio-scsi-pci.disable-legacy=on -global virtio-scsi-pci.disable-modern=off -global virtio-scsi-pci.iommu_platform=on -global virtio-blk-pci.disable-legacy=on -global virtio-blk-pci.disable-modern=off -global virtio-blk-pci.iommu_platform=on -global virtio-net-pci.disable-legacy=on -global virtio-net-pci.disable-modern=off -global virtio-net-pci.iommu_platform=on -global virtio-serial-pci.disable-legacy=on -global virtio-serial-pci.disable-modern=off -global virtio-serial-pci.iommu_platform=on -global virtio-balloon-pci.disable-legacy=on -global virtio-balloon-pci.disable-modern=off -global virtio-balloon-pci.iommu_platform=on"
        smp = 80
        mem = 81920
        vcpu_cores = 80
        vcpu_threads = 1
        vcpu_sockets =  1
        vcpu_maxcpus = 80
        variants:
            - singlevm:
                variants:
                    - reboottest:
                        only io-github-autotest-qemu.reboot
                        reboot_count = 6
            - multivm:
                mem = 8192
                vms = "vm1 vm2 vm3 vm4"
                smp_vm1 = 16
                vcpu_cores_vm1 = 16
                vcpu_threads_vm1 = 1
                vcpu_sockets_vm1 =  1
                vcpu_maxcpus_vm1 = 16
                smp_vm2 = 16
                vcpu_cores_vm2 = 8
                vcpu_threads_vm2 = 2
                vcpu_sockets_vm2 =  1
                vcpu_maxcpus_vm2 = 16
                smp_vm3 = 16
                vcpu_cores_vm3 = 4
                vcpu_threads_vm3 = 4
                vcpu_sockets_vm3 =  1
                vcpu_maxcpus_vm3 = 16
                smp_vm4 = 16
                vcpu_cores_vm4 = 2
                vcpu_threads_vm4 = 8
                vcpu_sockets_vm4 =  1
                vcpu_maxcpus_vm4 = 16
                variants:
                    - reboottest:
                        guest_stress = no
                        host_stress = no
                        host_stress_events = ""
                        stress_events = "reboot"
                        stress_itrs = 6
                        test_timeout = 6000000
                        event_sleep_time = 30
                        itr_sleep_time = 30
                        only multivm_cpustress.custom_host_events.custom_vm_events

